var indexController={initView:function(){var e=this.myScroll=new IScroll("#wrapper",{probeType:3,scrollbars:!1,click:!0});localFun.doFixedNav(),localFun.downloadCover(0),localFun.messageIcon(),this.initBaseView(),this.initSearchView(),this.initPromotionQuestionView(),this.scrollEvent.init(e),this.countVisit()},initBaseView:function(){var e=$.GetQueryString("sd_wechat_login");if(e){var t=e.replace(/\*/g,"="),o=new $.Base64,i=o.decode(t),n=JSON.parse(i);local.userId=n.sd_user_id,local.indent=n.indent,local.username=n.username,local.phone=n.mobile,local.sex=n.sex,local.name=n.realname,local.token=n.accessToken}},initSearchView:function(){$("#select_money").change(function(){$(this).next("b").text($(this).find("option:selected").text());var e=$(".select_money").find("b").text(),t=e.replace("元","").replace("金额不限","").replace("万","0000");local.screenMoneyIdx=$("option:selected").index(),local.screenMoney=t,local.screenShowMoney=$(this).next("b").text(),window.location.href="/html/product.html"})},initPromotionQuestionView:function(){$("#recommend_Btn").on("click",function(){$.promptCover({content:"据您个人信息为您精准推荐最适合产品，请务必保证信息真实完整，以提高推荐精度。<p style='text-align:center;padding-top:.3rem;'>在“我的”可完善身份信用。</p>"})}),$("#new_Btn").on("click",function(){$.promptCover({content:"速贷之家为全国最大速贷新品首发平台！您可到速贷大全－排序查看最新产品！"})})},doSubjectsBannerView:function(e){$.each(e,function(e,t){$(".newSelected").append("<div class='swiper-slide'><a href="+t.h5_link+"><img src="+t.src+"></a></div>")});new Swiper("#newSelected",{scrollbar:".swiper-scrollbar",scrollbarHide:!1,slidesPerView:1.83,spaceBetween:10,grabCursor:!1,freeMode:!0})},doSpecialListView:function(e){var t="";$.each(e.list,function(e,o){t+="<img src="+o.src+" data-id="+o.id+" data-title="+o.title+">"}),$(".themes_imgbox").html(t),this.myScroll.refresh(),$(".themes_imgbox>img").on("click",function(){var e=$(this).data("id"),t=$(this).data("title");window.location.href="/html/index_list.html?listId="+e+"&title="+t});var o=$(".themes_imgbox img").length;o%3!=0&&($(".themes_imgbox").append('<img src="img/moreactivity.png" class="coming_soon">'),$(".coming_soon").on("click",function(){$.popupCover({content:"敬请期待"})}))},theNextbatchIndex:1,doNextbatchView:function(e){var t="",o=Math.ceil(e.length/8),i=8*this.theNextbatchIndex,n=8*(this.theNextbatchIndex-1);this.theNextbatchIndex==o?(i=e.length,this.theNextbatchIndex=1):this.theNextbatchIndex++;for(var r=n;i>r;r++){var a=e[r];t+="<dl data-id="+a.platform_product_id+"><dt><img src="+a.product_logo+"></dt><dd><p><em>"+a.platform_product_name+"</em><br><span>"+a.loan_min+"-"+a.loan_max+"</span><br>成功率<b>"+a.success_rate+"</b></p></dd></dl>"}$("#recommend_list").html(t),$("#recommend_list").on("click","dl",function(){var e=$(this).data("id");window.location.href="/html/product_result.html?productId="+e})},doViewNewproducts:function(e){var t="";$.each(e,function(e,o){t+='<dl class="terrace_list" data-id='+o.platform_product_id+"><dt><div><img src="+o.product_logo+'></div></dt><dd><h3><span class="gradient">'+o.update_date+"</span><b id="+o.platform_product_id+">"+o.platform_product_name+"</b> "+o.product_conduct+'</h3><p class="p1 terrace_list_p1">',$.each(o.tag_name,function(e,o){t+=" <span style='color:#"+o.font_color+";border-color:#"+o.boder_color+";background:#"+o.bg_color+";'>"+o.name+"</span>"}),t+='</p><p class="p2">'+o.product_introduct+"</p></dd></dl>"}),$("#new_terrace").html(t),this.myScroll.refresh(),$.each($(".terrace_list_p1"),function(){var e=$(this).find("span"),t=e.length;t>4&&(e.eq(3).nextAll("span").hide(),$(this).append('<i class="sl"></i>'))}),$(".terrace_list").on("click",function(){var e=$(this).data("id");window.location.href="/html/product_result.html?productId="+e})},countVisit:function(){var e=this;if(localStorage.userId){service.doAjaxRequest({url:"/v1/data/activeuser",type:"POST",data:{}},function(e){});var t=$.cookie("homePage_location")||"";""==t&&($.cookie("homePage_location","false",{expires:7,path:"/"}),e.doLocationView.initView())}},scrollEvent:{myScroll:null,finished:!0,refresh:!1,init:function(e){this.scrollStart(e)},scrollStart:function(e){e.on("scrollStart",function(){startY=e.y}),this.scrollIn(e)},scrollIn:function(e){var t=this;e.on("scroll",function(){function i(){$(".pullUpImgClose").show(),setTimeout(function(){$(".pullUpImgClose").hide()},1e3)}$(".pullUpImg").show();var o=-e.y;if(t.finished&&-40>o&&0==startY&&(finished=!1,$("#pullDown-msg").text("松开刷新"),$("#PullDown").css({position:"static"}),e.scrollToElement(PullDown,0),$("#wrapper").on("touchend",function(){$("#pullDown-msg").text("刷新中..."),refresh=!0,setTimeout(function(){window.location.reload()},1e3)})),e.on("scrollEnd",function(){o>=-10&&!t.refresh&&$(".head_top").show()}),t.finished&&startY<=this.maxScrollY&&this.maxScrollY+o>=80){finished=!1,i();var n=setInterval(function(){i()},2e3),r=setTimeout(function(){clearInterval(n),setTimeout(function(){window.location.href="/html/product.html"})},6e3);e.on("scrollEnd",function(){finished=!0,clearInterval(n),clearInterval(r),$(".pullUpImgClose").show(),window.location.href="/html/product.html"})}t.scrollEnd(e)})},scrollEnd:function(e){e.on("scrollEnd",function(){e.refresh()})}},doLocationView:{initView:function(){this.doAddressView()},doAddressView:function(){function o(e){longitude=e.position.getLng(),latitude=e.position.getLat(),gpsPoint=new BMap.Point(longitude,latitude),BMap.Convertor.translate(gpsPoint,0,translateCallback)}function i(e){baiduAddress=e.addressComponents;var t=baiduAddress.city+baiduAddress.district+baiduAddress.street+baiduAddress.streetNumber,o=baiduAddress.city;local.sd_positionmessage=o;var i=longitude+","+latitude;service.doAjaxRequest({url:"/v1/location/device",type:"POST",async:!1,data:{deviceId:$.cookie("sd_equipment_id"),userCity:o,userAddress:t,lonLat:i,areaId:"0",locationType:"2"}})}function n(e){}var e,t;e=new AMap.Map("",{resizeEnable:!0}),e.plugin("AMap.Geolocation",function(){t=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB"}),e.addControl(t),t.getCurrentPosition(),AMap.event.addListener(t,"complete",o),AMap.event.addListener(t,"error",n)}),translateCallback=function(e){baiduPoint=e;var t=new BMap.Geocoder;t.getLocation(baiduPoint,i)}}}};$(function(){indexController.initView(),service.doAjaxRequest({url:"/v1/product/recommends",type:"GET"},function(e){indexController.doNextbatchView(e.list),$(".nextBatch").on("click",function(){indexController.doNextbatchView(e.list)})}),service.doAjaxRequest({url:"/v1/banners/subjects",type:"GET"},function(e){indexController.doSubjectsBannerView(e)}),service.doAjaxRequest({url:"/v2/banners/special",type:"GET"},function(e){indexController.doSpecialListView(e)}),service.doAjaxRequest({url:"/v1/product/online",type:"GET"},function(e){indexController.doViewNewproducts(e)})});