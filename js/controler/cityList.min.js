var cityListController={initView:function(){var e=this;e.myScroll=new IScroll("#wrapper",{probeType:3,scrollbars:!1,click:!0}),e.userAddress="",e.lonLat="",e.initJudgeView(),e.doOperationView()},initJudgeView:function(){var e=this;localStorage.sd_positionmessage?$("#address").text(localStorage.sd_positionmessage).addClass("sureCity"):e.doAddressView()},doOperationView:function(){var e=this;$(".reposition").on("click",function(){$("#address").html("定位中...").removeClass("sureCity"),e.doAddressView()}),$(document).on("click",".cityList>li,.hotCitylist>span",function(){var e=$(this).text(),t=$(this).attr("id");service.doAjaxRequest({url:"/v1/location/device",type:"POST",async:!1,data:{deviceId:$.cookie("sd_equipment_id"),userCity:e,userAddress:"",lonLat:"",areaId:"0"}},function(){}),local.cityLocation=e,local.cityId=t,window.location.href="/html/product.html"}),$("#address").on("click",function(){$(this).hasClass("sureCity")&&(local.cityLocation=$(this).text(),local.cityId=localStorage.addressId,window.location.href="/html/product.html")})},initSliderView:function(){var e=this,t=["hotCity","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="";$.each(t,function(e,t){n+="<li><a class='aToz' href=#"+t+">"+t+"</a></li>"}),$(".slider-nav>ol").html(n),$("ol>li").eq(0).css({height:"0.6rem"}),$("ol>li").eq(0).find("a").html("热门").css({display:"block",background:"url(../img/dingwei.png) no-repeat center top","background-size":"0.3rem","padding-top":"0.3rem","font-size":"0.18rem"});var i=$(".slider-nav li a");i.on("click",function(t){t.preventDefault();var n=this.hash;return e.myScroll.scrollToElement(n,500),!1}),e.myScroll.on("scroll",function(){var e=$("#hotCity").height(),t=$("#wrapper").offset().top;this.y>=-e?$(".fixedNav,.centerfixedNav").fadeOut(200):$.each($(".slider-content>li"),function(){var e=$(this).offset().top-t,n=$(this).find("h3").text();0>=e&&$(".fixedNav,.centerfixedNav").html(n).show()})}),e.myScroll.on("scrollEnd",function(){var e=this.y-this.maxScrollY;(0==e||0==this.y)&&$(".centerfixedNav").fadeOut(500)})},doAddressView:function(){function i(e){longitude=e.position.getLng(),latitude=e.position.getLat(),gpsPoint=new BMap.Point(longitude,latitude),BMap.Convertor.translate(gpsPoint,0,translateCallback)}function o(t){baiduAddress=t.addressComponents,e.userAddress=baiduAddress.city+baiduAddress.district+baiduAddress.street+baiduAddress.streetNumber;var n=baiduAddress.city;$("#address").html(n).addClass("sureCity"),local.sd_positionmessage=n,e.lonLat=longitude+","+latitude,service.doAjaxRequest({url:"/v1/location/device",type:"POST",async:!1,data:{deviceId:$.cookie("sd_equipment_id"),userCity:n,userAddress:e.userAddress,lonLat:e.lonLat,areaId:"0"}},function(e){$("#address").attr("data-id",e.areaId),local.addressId=e.areaId})}function r(e){$("#address").html("定位失败")}var e=this;$("#address").text("定位中...");var t,n;t=new AMap.Map("",{resizeEnable:!0}),t.plugin("AMap.Geolocation",function(){n=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB"}),t.addControl(n),n.getCurrentPosition(),AMap.event.addListener(n,"complete",i),AMap.event.addListener(n,"error",r)}),translateCallback=function(e){baiduPoint=e;var t=new BMap.Geocoder;t.getLocation(baiduPoint,o)}},doCityListView:function(e){var t=this,n=e,i="",o="";$.each(n.hotCity,function(e,t){i+="<span id="+t.id+" class="+t.id+">"+t.name+"</span>"}),$(".hotCitylist").html(i),$.each(n.list,function(e,t){o+="<li id="+t.initial+"><h3>"+t.initial+"</h3><ul class='cityList'>",$.each(t.citys,function(e,t){o+="<li id="+t.id+"  class="+t.id+">"+t.name+"</li>"}),o+="</ul></li>"}),$(".slider-content").html(o),t.myScroll.refresh(),t.initSliderView(),localStorage.cityId&&localStorage.cityLocation?($("."+localStorage.cityId).addClass("selectStyle"),$("header>b").text("当前选择-"+localStorage.cityLocation)):$("header>b").text("选择城市")}};$(function(){cityListController.initView(),service.doAjaxRequest({url:"/v1/location/devices",type:"GET",async:!1},function(e){cityListController.doCityListView(e)})}),$(window).load(function(){cityListController.myScroll.refresh()});